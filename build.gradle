apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'application'

mainClassName = "unluac.Main"

sourceSets {
    main {
        java {
            srcDirs = ['src']
        }
    }
    test {
        java {
            srcDir 'test'
        }
    }
}

jar {
    manifest {
        attributes (
            "main-class": mainClassName
        )
    }
}

task runTests50(type: Exec, dependsOn: classes) {
    commandLine 'java', '-cp', 'build/classes/main', '-Dluac=luac\\luac50', 'unluac.test.RunTests'
}

task runTests51(type: Exec, dependsOn: classes) {
    commandLine 'java', '-cp', 'build/classes/main', '-Dluac=luac\\luac5.1', 'unluac.test.RunTests'
}

task runTests52(type: Exec, dependsOn: classes) {
    commandLine 'java', '-cp', 'build/classes/main', '-Dluac=luac\\luac52', 'unluac.test.RunTests'
}

task runTests(dependsOn: [runTests50, runTests51, runTests52]) {
}

build.dependsOn runTests
